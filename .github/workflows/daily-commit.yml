name: Daily Auto Commit
on:
  schedule:
    # Fixed cron syntax - needs 5 asterisks
    - cron: '0 12 * * *'
  
  # Allow manual trigger for testing
  workflow_dispatch:
jobs:
  auto-commit:
    runs-on: ubuntu-latest
    # Add explicit permissions
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Setup Git User
        run: |
          git config --global user.name 'github-actions'
          git config --global user.email 'github-actions@github.com'
      
      - name: Create/Update Daily Log and README
        run: |
          # Get the date and quote
          CURRENT_DATE=$(date)
          SYSTEM_INFO=$(uname -a)
          QUOTE_DATA=$(curl -s https://api.quotable.io/random)
          QUOTE_CONTENT=$(echo "$QUOTE_DATA" | jq -r '.content')
          QUOTE_AUTHOR=$(echo "$QUOTE_DATA" | jq -r '.author')
          
          # Update the log file
          echo "Last updated: $CURRENT_DATE" > update_log.txt
          echo "System info: $SYSTEM_INFO" >> update_log.txt
          echo "Random quote of the day: $QUOTE_CONTENT - $QUOTE_AUTHOR" >> update_log.txt
          
          # Use awk to extract everything before the quote section
          awk '/## Today'"'"'s Quote/{exit} {print}' README.md > temp_readme.md || true
          
          # Add the new quote section
          echo "## Today's Quote" >> temp_readme.md
          echo "" >> temp_readme.md
          echo "> $QUOTE_CONTENT" >> temp_readme.md
          echo ">" >> temp_readme.md
          echo "> â€” *$QUOTE_AUTHOR*" >> temp_readme.md
          echo "" >> temp_readme.md
          echo "Last updated: $CURRENT_DATE" >> temp_readme.md
          
          # Replace the old README with the new one
          mv temp_readme.md README.md || true
      
      - name: Commit and Push
        run: |
          git add .
          git commit -m "this project cheeses my github" || echo "No changes to commit"
          git push
